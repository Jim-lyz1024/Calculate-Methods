#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#define MAX 10
#define epsilon 1e-6
float f(float x)
{
    return 4/(1+x*x);
}
float Romberg(float a,float b)
{
    int m,n,i,k;
    float h,x,s,q,eps;
    float *y=(float *)malloc(MAX*sizeof(float));
    float p;
    h=b-a;
    y[0]=h*(f(a)+f(b))/2.0;
    m=1,n=1;
    eps=epsilon+1.0;
    while((eps>=epsilon)&&m<MAX)
    {
        p=0.0;
        for(i=0;i<n;i++)
        {
            x=a+(i+0.5)*h;
            p=p+f(x);
        }
        p=(y[0]+h*p)/2.0;
        s=1.0;
        for(k=1;k<=m;k++)
        {
            s=4.0*s;
            q=(s*p-y[k-1])/(s-1.0);
            y[k-1]=p;
            p=q;
        }
        p=fabs(q-y[m-1]);
        m=m+1;
        y[m-1]=q;
        n=n+n;
        h=h/2.0;
    }
    return q;
}

int main()
{
    float a,b,I;
    printf("请输入积分限：a,b:");
    scanf("%f,%f",&a,&b);
    I=Romberg(a,b);
    printf("积分的结果是：I=%f",I);
    return 0;
}